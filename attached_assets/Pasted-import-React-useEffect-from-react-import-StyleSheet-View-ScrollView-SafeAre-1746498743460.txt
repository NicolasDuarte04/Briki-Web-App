import React, { useEffect } from 'react';
import { 
  StyleSheet, 
  View, 
  ScrollView, 
  SafeAreaView, 
  TouchableOpacity, 
  Platform, 
  Dimensions,
  Image
} from 'react-native';
import { router } from 'expo-router';
import { ThemedText } from '../../components/ThemedText';
import { ThemedView } from '../../components/ThemedView';
import { Ionicons } from '@expo/vector-icons';
import { StatusBar } from 'expo-status-bar';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { LinearGradient } from 'expo-linear-gradient';
import Animated, {
  useSharedValue,
  useAnimatedStyle,
  withTiming,
  withSpring,
  withSequence,
  FadeIn,
  FadeInUp,
  SlideInRight
} from 'react-native-reanimated';
import * as Haptics from 'expo-haptics';
import { useThemeColor } from '../../hooks/useThemeColor';
import { useThemeContext } from '../context/ThemeContext';

const { width } = Dimensions.get('window');
const AnimatedTouchable = Animated.createAnimatedComponent(TouchableOpacity);

// Define brand colors centrally
const BRAND = {
  primary: '#4B76E5',
  primaryDark: '#3D68D8',
  secondary: '#F8B400',
  success: '#34C759',
  danger: '#FF3B30',
};

export default function ExploreScreen() {
  const insets = useSafeAreaInsets();
  const { theme } = useThemeContext();
  const isDarkMode = theme === 'dark';

  // Get theme colors
  const backgroundColor = useThemeColor({}, 'background');
  const cardBackgroundColor = useThemeColor({}, 'card');
  const textColor = useThemeColor({}, 'text');
  const textSecondaryColor = useThemeColor({}, 'secondaryText');
  const borderColor = useThemeColor({}, 'border');
  const dividerColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';

  // Compute derived colors
  const primaryTransparent = isDarkMode 
    ? 'rgba(75, 118, 229, 0.15)' 
    : 'rgba(75, 118, 229, 0.1)';
  const secondaryTransparent = isDarkMode 
    ? 'rgba(248, 180, 0, 0.15)' 
    : 'rgba(248, 180, 0, 0.1)';

  // Overlay colors for gradients
  const primaryGradientColors = isDarkMode 
    ? ['rgba(75, 118, 229, 0.2)', 'rgba(75, 118, 229, 0.1)', 'rgba(18, 18, 18, 0)']
    : ['rgba(75, 118, 229, 0.12)', 'rgba(248, 180, 0, 0.08)', 'rgba(255, 255, 255, 0)'];

  const ctaGradientColors = isDarkMode 
    ? ['rgba(75, 118, 229, 0.2)', 'rgba(75, 118, 229, 0.1)']
    : ['rgba(75, 118, 229, 0.1)', 'rgba(75, 118, 229, 0.05)'];

  // Animation values
  const headerOpacity = useSharedValue(0);
  const buttonScale = useSharedValue(1);

  useEffect(() => {
    // Animate header when component mounts
    headerOpacity.value = withTiming(1, { duration: 800 });
  }, []);

  const headerStyle = useAnimatedStyle(() => ({
    opacity: headerOpacity.value
  }));

  const buttonStyle = useAnimatedStyle(() => ({
    transform: [{ scale: buttonScale.value }]
  }));

  const handleGetStarted = () => {
    // Animate button press
    buttonScale.value = withSequence(
      withTiming(0.95, { duration: 100 }),
      withTiming(1, { duration: 100 })
    );

    // Provide haptic feedback
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);

    // Navigate to trip info screen
    router.push('/trip-info');
  };

  return (
    <SafeAreaView style={[
      styles.container, 
      { 
        paddingTop: Platform.OS === 'android' ? insets.top : 0,
        backgroundColor: backgroundColor 
      }
    ]}>
      <StatusBar style={isDarkMode ? "light" : "dark"} />

      {/* Header Background Gradient */}
      <Animated.View style={[styles.headerBackground, headerStyle]}>
        <LinearGradient
          colors={primaryGradientColors}
          locations={[0, 0.6, 1]}
          style={styles.headerGradient}
        />
      </Animated.View>

      <ScrollView 
        style={[styles.scrollView, { backgroundColor: backgroundColor }]}
        contentContainerStyle={styles.scrollContent}
        showsVerticalScrollIndicator={false}
      >
        {/* Header Section */}
        <View style={styles.headerContainer}>
          <Animated.View entering={FadeIn.delay(100).duration(800)}>
            <ThemedText style={[styles.logo, { color: BRAND.primary }]}>Briki</ThemedText>
          </Animated.View>
          <Animated.View entering={FadeInUp.delay(300).duration(800)}>
            <ThemedText style={[styles.headerTitle, { color: textColor }]}>Travel Insurance Made Simple</ThemedText>
          </Animated.View>
        </View>

        {/* What is Briki Section */}
        <Animated.View 
          entering={FadeInUp.delay(400).springify()}
          style={styles.section}
        >
          <View style={styles.sectionHeader}>
            <View style={[styles.iconContainer, { backgroundColor: primaryTransparent }]}>
              <Ionicons name="information-circle" size={24} color={BRAND.primary} />
            </View>
            <ThemedText style={[styles.sectionTitle, { color: textColor }]}>What is Briki?</ThemedText>
          </View>

          <ThemedText style={[styles.sectionText, { color: textSecondaryColor }]}>
            Briki is a modern platform designed to simplify travel insurance by helping travelers find, compare, and purchase the perfect insurance plan for their journey.
          </ThemedText>

          <ThemedText style={[styles.sectionText, { color: textSecondaryColor }]}>
            We partner with leading global insurance providers to offer a wide variety of coverage options, all in one place. No paperwork, no confusing terms, just simple protection for your adventures.
          </ThemedText>
        </Animated.View>

        {/* How It Works Section */}
        <Animated.View
          entering={FadeInUp.delay(500).springify()}
          style={styles.section}
        >
          <View style={styles.sectionHeader}>
            <View style={[styles.iconContainer, styles.goldIconContainer, { backgroundColor: secondaryTransparent }]}>
              <Ionicons name="git-network" size={24} color={BRAND.secondary} />
            </View>
            <ThemedText style={[styles.sectionTitle, { color: textColor }]}>How Briki Works</ThemedText>
          </View>

          <View style={styles.stepsContainer}>
            <View style={styles.stepItem}>
              <View style={[styles.stepNumberContainer, { backgroundColor: primaryTransparent }]}>
                <ThemedText style={[styles.stepNumber, { color: BRAND.primary }]}>1</ThemedText>
              </View>
              <View style={styles.stepContent}>
                <ThemedText style={[styles.stepTitle, { color: textColor }]}>Enter Trip Details</ThemedText>
                <ThemedText style={[styles.stepDescription, { color: textSecondaryColor }]}>
                  Fill in basic information about your trip, such as destination, dates, and traveler details.
                </ThemedText>
              </View>
            </View>

            <View style={[styles.stepDivider, { backgroundColor: dividerColor }]} />

            <View style={styles.stepItem}>
              <View style={[styles.stepNumberContainer, { backgroundColor: primaryTransparent }]}>
                <ThemedText style={[styles.stepNumber, { color: BRAND.primary }]}>2</ThemedText>
              </View>
              <View style={styles.stepContent}>
                <ThemedText style={[styles.stepTitle, { color: textColor }]}>Compare Plans</ThemedText>
                <ThemedText style={[styles.stepDescription, { color: textSecondaryColor }]}>
                  Browse and compare insurance plans from top providers with detailed coverage information.
                </ThemedText>
              </View>
            </View>

            <View style={[styles.stepDivider, { backgroundColor: dividerColor }]} />

            <View style={styles.stepItem}>
              <View style={[styles.stepNumberContainer, { backgroundColor: primaryTransparent }]}>
                <ThemedText style={[styles.stepNumber, { color: BRAND.primary }]}>3</ThemedText>
              </View>
              <View style={styles.stepContent}>
                <ThemedText style={[styles.stepTitle, { color: textColor }]}>Purchase Instantly</ThemedText>
                <ThemedText style={[styles.stepDescription, { color: textSecondaryColor }]}>
                  Select the perfect plan and complete your purchase securely in just a few minutes.
                </ThemedText>
              </View>
            </View>
          </View>
        </Animated.View>

        {/* Why Travel Insurance Matters Section */}
        <Animated.View
          entering={FadeInUp.delay(600).springify()}
          style={styles.section}
        >
          <View style={styles.sectionHeader}>
            <View style={[styles.iconContainer, { backgroundColor: primaryTransparent }]}>
              <Ionicons name="shield-checkmark" size={24} color={BRAND.primary} />
            </View>
            <ThemedText style={[styles.sectionTitle, { color: textColor }]}>Why Travel Insurance Matters</ThemedText>
          </View>

          <View style={[styles.infoCard, { backgroundColor: cardBackgroundColor, borderColor: borderColor }]}>
            <ThemedText style={[styles.infoCardText, { color: textSecondaryColor }]}>
              Unexpected events can disrupt even the most carefully planned trips. From medical emergencies and flight cancellations to lost luggage and natural disasters, travel insurance helps protect your financial investment and provides peace of mind.
            </ThemedText>
          </View>

          <View style={styles.statsContainer}>
            <View style={styles.statItem}>
              <ThemedText style={[styles.statNumber, { color: BRAND.primary }]}>$30,000+</ThemedText>
              <ThemedText style={[styles.statLabel, { color: textSecondaryColor }]}>Average cost of emergency medical evacuation abroad</ThemedText>
            </View>

            <View style={styles.statItem}>
              <ThemedText style={[styles.statNumber, { color: BRAND.primary }]}>20%</ThemedText>
              <ThemedText style={[styles.statLabel, { color: textSecondaryColor }]}>Of travelers experience some type of trip disruption</ThemedText>
            </View>

            <View style={styles.statItem}>
              <ThemedText style={[styles.statNumber, { color: BRAND.primary }]}>1 in 6</ThemedText>
              <ThemedText style={[styles.statLabel, { color: textSecondaryColor }]}>Travelers need to cancel trips due to unexpected circumstances</ThemedText>
            </View>
          </View>
        </Animated.View>

        {/* Key Benefits Section */}
        <Animated.View
          entering={FadeInUp.delay(700).springify()}
          style={styles.section}
        >
          <View style={styles.sectionHeader}>
            <View style={[styles.iconContainer, styles.goldIconContainer, { backgroundColor: secondaryTransparent }]}>
              <Ionicons name="star" size={24} color={BRAND.secondary} />
            </View>
            <ThemedText style={[styles.sectionTitle, { color: textColor }]}>Briki Benefits</ThemedText>
          </View>

          <View style={styles.benefitsContainer}>
            <View style={styles.benefitItem}>
              <Ionicons name="checkmark-circle" size={24} color={BRAND.success} style={styles.benefitIcon} />
              <ThemedText style={[styles.benefitText, { color: textSecondaryColor }]}>Compare multiple plans in seconds</ThemedText>
            </View>

            <View style={styles.benefitItem}>
              <Ionicons name="checkmark-circle" size={24} color={BRAND.success} style={styles.benefitIcon} />
              <ThemedText style={[styles.benefitText, { color: textSecondaryColor }]}>Real-time pricing with no hidden fees</ThemedText>
            </View>

            <View style={styles.benefitItem}>
              <Ionicons name="checkmark-circle" size={24} color={BRAND.success} style={styles.benefitIcon} />
              <ThemedText style={[styles.benefitText, { color: textSecondaryColor }]}>Coverage from trusted global providers</ThemedText>
            </View>

            <View style={styles.benefitItem}>
              <Ionicons name="checkmark-circle" size={24} color={BRAND.success} style={styles.benefitIcon} />
              <ThemedText style={[styles.benefitText, { color: textSecondaryColor }]}>Instant policy documents via email</ThemedText>
            </View>

            <View style={styles.benefitItem}>
              <Ionicons name="checkmark-circle" size={24} color={BRAND.success} style={styles.benefitIcon} />
              <ThemedText style={[styles.benefitText, { color: textSecondaryColor }]}>COVID-19 coverage options available</ThemedText>
            </View>

            <View style={styles.benefitItem}>
              <Ionicons name="checkmark-circle" size={24} color={BRAND.success} style={styles.benefitIcon} />
              <ThemedText style={[styles.benefitText, { color: textSecondaryColor }]}>24/7 emergency assistance with most plans</ThemedText>
            </View>
          </View>
        </Animated.View>

        {/* Featured Providers Section */}
        <Animated.View
          entering={FadeInUp.delay(800).springify()}
          style={styles.section}
        >
          <View style={styles.sectionHeader}>
            <View style={[styles.iconContainer, { backgroundColor: primaryTransparent }]}>
              <Ionicons name="business" size={24} color={BRAND.primary} />
            </View>
            <ThemedText style={[styles.sectionTitle, { color: textColor }]}>Our Insurance Partners</ThemedText>
          </View>

          <View style={styles.partnersContainer}>
            <View style={styles.partnerItem}>
              <View style={[styles.partnerLogoContainer, { backgroundColor: primaryTransparent }]}>
                <ThemedText style={[styles.partnerLogo, { color: BRAND.primary }]}>AXA</ThemedText>
              </View>
              <ThemedText style={[styles.partnerName, { color: textColor }]}>AXA Assistance</ThemedText>
            </View>

            <View style={styles.partnerItem}>
              <View style={[styles.partnerLogoContainer, { backgroundColor: primaryTransparent }]}>
                <ThemedText style={[styles.partnerLogo, { color: BRAND.primary }]}>AC</ThemedText>
              </View>
              <ThemedText style={[styles.partnerName, { color: textColor }]}>Assist Card</ThemedText>
            </View>

            <View style={styles.partnerItem}>
              <View style={[styles.partnerLogoContainer, { backgroundColor: primaryTransparent }]}>
                <ThemedText style={[styles.partnerLogo, { color: BRAND.primary }]}>IATI</ThemedText>
              </View>
              <ThemedText style={[styles.partnerName, { color: textColor }]}>IATI</ThemedText>
            </View>

            <View style={styles.partnerItem}>
              <View style={[styles.partnerLogoContainer, { backgroundColor: primaryTransparent }]}>
                <ThemedText style={[styles.partnerLogo, { color: BRAND.primary }]}>SR</ThemedText>
              </View>
              <ThemedText style={[styles.partnerName, { color: textColor }]}>SURA</ThemedText>
            </View>

            <View style={styles.partnerItem}>
              <View style={[styles.partnerLogoContainer, { backgroundColor: primaryTransparent }]}>
                <ThemedText style={[styles.partnerLogo, { color: BRAND.primary }]}>ST</ThemedText>
              </View>
              <ThemedText style={[styles.partnerName, { color: textColor }]}>Starr</ThemedText>
            </View>
          </View>
        </Animated.View>

        {/* CTA Section */}
        <Animated.View
          entering={SlideInRight.delay(900).springify()}
          style={styles.ctaSection}
        >
          <LinearGradient
            colors={ctaGradientColors}
            start={{ x: 0, y: 0 }}
            end={{ x: 1, y: 1 }}
            style={styles.ctaGradient}
          >
            <ThemedText style={[styles.ctaTitle, { color: textColor }]}>Ready to Travel Confidently?</ThemedText>
            <ThemedText style={[styles.ctaText, { color: textSecondaryColor }]}>
              Get a personalized quote in just a few clicks and ensure your next adventure is protected.
            </ThemedText>

            <AnimatedTouchable
              style={[styles.ctaButton, buttonStyle]}
              onPress={handleGetStarted}
              activeOpacity={0.9}
            >
              <LinearGradient
                colors={[BRAND.primary, BRAND.primaryDark]}
                start={{ x: 0, y: 0 }}
                end={{ x: 1, y: 0 }}
                style={styles.ctaButtonGradient}
              >
                <ThemedText style={styles.ctaButtonText}>Get Started</ThemedText>
                <Ionicons name="arrow-forward" size={20} color="#FFFFFF" style={styles.ctaButtonIcon} />
              </LinearGradient>
            </AnimatedTouchable>
          </LinearGradient>
        </Animated.View>
      </ScrollView>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  headerBackground: {
    position: 'absolute',
    top: 0,
    left: 0,
    right: 0,
    height: 200,
    zIndex: -1,
  },
  headerGradient: {
    width: '100%',
    height: '100%',
  },
  scrollView: {
    flex: 1,
  },
  scrollContent: {
    paddingBottom: 40,
  },
  headerContainer: {
    alignItems: 'center',
    paddingVertical: 24,
    paddingHorizontal: 24,
  },
  logo: {
    fontSize: 32,
    fontWeight: '700',
    marginBottom: 16,
  },
  headerTitle: {
    fontSize: 26,
    fontWeight: '600',
    textAlign: 'center',
    maxWidth: '90%',
  },
  section: {
    paddingHorizontal: 24,
    marginBottom: 32,
  },
  sectionHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 16,
  },
  iconContainer: {
    width: 40,
    height: 40,
    borderRadius: 20,
    alignItems: 'center',
    justifyContent: 'center',
    marginRight: 12,
  },
  goldIconContainer: {
    // backgroundColor handled dynamically
  },
  sectionTitle: {
    fontSize: 20,
    fontWeight: '600',
  },
  sectionText: {
    fontSize: 16,
    lineHeight: 24,
    marginBottom: 16,
  },
  stepsContainer: {
    marginTop: 8,
  },
  stepItem: {
    flexDirection: 'row',
    marginBottom: 20,
  },
  stepNumberContainer: {
    width: 36,
    height: 36,
    borderRadius: 18,
    alignItems: 'center',
    justifyContent: 'center',
    marginRight: 16,
    marginTop: 2,
  },
  stepNumber: {
    fontSize: 18,
    fontWeight: '600',
  },
  stepContent: {
    flex: 1,
  },
  stepTitle: {
    fontSize: 18,
    fontWeight: '600',
    marginBottom: 6,
  },
  stepDescription: {
    fontSize: 15,
    lineHeight: 22,
  },
  stepDivider: {
    height: 24,
    width: 1,
    marginLeft: 18,
    marginBottom: 20,
  },
  infoCard: {
    borderWidth: 1,
    borderRadius: 16,
    padding: 20,
    marginBottom: 24,
  },
  infoCardText: {
    fontSize: 15,
    lineHeight: 24,
  },
  statsContainer: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    justifyContent: 'space-between',
  },
  statItem: {
    width: '48%',
    marginBottom: 20,
  },
  statNumber: {
    fontSize: 22,
    fontWeight: '700',
    marginBottom: 6,
  },
  statLabel: {
    fontSize: 14,
    lineHeight: 20,
  },
  benefitsContainer: {
    marginTop: 8,
  },
  benefitItem: {
    flexDirection: 'row',
    alignItems: 'flex-start',
    marginBottom: 16,
  },
  benefitIcon: {
    marginRight: 12,
    marginTop: 2,
  },
  benefitText: {
    fontSize: 16,
    lineHeight: 24,
    flex: 1,
  },
  partnersContainer: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    justifyContent: 'space-between',
    marginTop: 8,
  },
  partnerItem: {
    width: '30%',
    alignItems: 'center',
    marginBottom: 24,
  },
  partnerLogoContainer: {
    width: 60,
    height: 60,
    borderRadius: 30,
    alignItems: 'center',
    justifyContent: 'center',
    marginBottom: 8,
  },
  partnerLogo: {
    fontSize: 16,
    fontWeight: '700',
  },
  partnerName: {
    fontSize: 14,
    textAlign: 'center',
  },
  ctaSection: {
    marginTop: 8,
    paddingHorizontal: 24,
    marginBottom: 40,
  },
  ctaGradient: {
    borderRadius: 20,
    padding: 24,
    alignItems: 'center',
  },
  ctaTitle: {
    fontSize: 22,
    fontWeight: '700',
    marginBottom: 12,
    textAlign: 'center',
  },
  ctaText: {
    fontSize: 16,
    textAlign: 'center',
    marginBottom: 24,
    lineHeight: 24,
  },
  ctaButton: {
    borderRadius: 16,
    overflow: 'hidden',
    width: '90%',
    shadowColor: '#4B76E5',
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.2,
    shadowRadius: 8,
    elevation: 4,
  },
  ctaButtonGradient: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'center',
    paddingVertical: 16,
  },
  ctaButtonText: {
    fontSize: 18,
    fontWeight: '600',
    color: '#FFFFFF',
  },
  ctaButtonIcon: {
    marginLeft: 8,
  },
});